---
title: Book Scanner
slug: book-scanner
fullpath: /guides/book-scanner
---

---

This guide describes how the book scanner works as of server `v2.4.5`.

## Book library scanner steps
1. Library folders are scanned and all supported files found are grouped into books
    - Subfolders will be grouped using the shallowest audio file or ebook file
    - Audio files or ebook files in the root of a library folder will be treated as individual books
    - If the "Audiobooks only" library setting is enabled ebook files will be ignored when grouping
2. Grouped books are looped over to see if it is an existing book or a new book
    - Existing books are looked up using exact filepath but falls back to the file [inode value](https://wikipedia.org/wiki/Inode) (to handle renames)
3. Books already in the library are checked for any that are missing
    - Looks for exact filepath but falls back to the file [inode value](https://wikipedia.org/wiki/Inode)
    - A book can also be set as missing if all audio files and ebook files are removed
4. Existing books found are checked for updates
    1. All audio files that are newly added or have been modified will be probed (using [ffprobe](https://ffmpeg.org/ffprobe.html))
    2. If any audio files have been added/updated/removed the book audio tracks will be re-ordered
    3. Cover image filepath is checked and cleared if it no longer exists
    4. If no cover image is set and an image is found in the folder group then it is set as the cover
        - If there are multiple images the filename of "cover" is preferred
    5. If an ebook file is set and it wasn't found in the scan it is cleared
    6. If no ebook is set and an ebook file is found in the scan it is set
        - If there are multiple ebook files `epub` is preferred, all other ebooks are flagged as supplemental
    7. Book metadata is parsed and set ([see more](#book-metadata-parsing))
    8. If no cover image is set and an image was found embedded in an audio file it is extracted and set
    9. If no cover image is set and "Find covers" server setting is enabled then a cover is searched for
        - Note: This setting is planned to be replaced by a more comprehensive metadata lookup
    10. If any book metadata was updated then the `metadata.[json/abs]` file is saved
5. Authors and series that were removed from books are checked for removal
    - Authors are removed if they have no books and have no additional metadata set (image, description or asin)
    - Series are removed if they have no books
6. New books found are added
    1. Audio files found are probed (using [ffprobe](https://ffmpeg.org/ffprobe.html)) and ordered
    2. If an ebook file is found (and "Audiobooks only" library setting is not set) it is set as primary
        - If there are multiple ebook files `epub` is preferred, all other ebooks are flagged as supplemental
    3. Book metadata is parsed and set ([see more](#book-metadata-parsing))
    4. Cover image is set using an image file found in folder
        - If there are multiple images the filename of "cover" is preferred
    5. If no cover image is set and an image was found embedded in an audio file it is extracted and set
    6. If no cover image is set and "Find covers" server setting is enabled then a cover is searched for
        - Note: This setting is planned to be replaced by a more comprehensive metadata lookup
    7. `metadata.[json/abs]` file is saved

---

## Book metadata parsing

When the scanner is populating book metadata it will use the order of precedence set in the "Scanner" tab of the library modal. The metadata parser listed last will have the final say on book metadata.

### Folder structure
Book metadata is pulled from folder names according to the [directory structure](/docs#book-directory-structure), [author folder naming](/docs#book-author-folder-naming) and [title folder naming](/docs#book-title-folder-naming) docs.
The metadata pulled from here can be: title, subtitle, asin, authors, narrators, series, series sequence, and published year

### Audio file meta tags
Audio file meta tags are found from [ffprobe](https://ffmpeg.org/ffprobe.html). After the audio files are sorted into track order the first audio file will be checked for meta tags following the [audio metadata](/docs#book-audio-metadata) docs.

### desc.txt & reader.txt files
If a file named `desc.txt` is found in the books folder it will be used as the description. If a file named `reader.txt` is found in the books folder it will be used as the narrator.

### OPF file
If a file with `.opf` extension is found in the books folder it will be parsed. (Example OPF file coming soon)

### Audiobookshelf metadata file
The `metadata.[json/abs]` file is automatically saved anytime book metadata is set. If the "Store metadata with item" server setting is enabled then the metadata file will be stored in the same folder as your book (only for books in subfolders). Otherwise, the metadata file is stored in `/metadata/items/`.

Every book metadata field is stored in this file including chapters.